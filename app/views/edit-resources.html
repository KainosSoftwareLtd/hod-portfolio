{% extends "layout.html" %}

{% block pageTitle %}
Edit resources
{% endblock %}

{% block content %}

<main id="content" role="main">
    <div class="grid-row">
        <section style="padding-top:30px;">
            <h1 class="form-title heading-large">
                Edit resources
            </h1>
            <div class="grid-row">
                <section class="column-half">
                    <h2 class="heading-medium">Edit resources for <a href="/projects/{{ projectId }}/{{ projectName | slugify }}/">{{ projectName }}</a></h2>
                    <div>
                        <table>
                            <thead>
                            <tr>
                                <td>Name</td>
                                <td>URL</td>
                                <td><!-- column for edition buttons --></td>
                            </tr>
                            </thead>
                            {% for resource in resources %}
                            <tr>
                                <td>{{ resource.name }}</td>
                                <td><a href="{{ resource.url }}">{{ resource.url }}</a></td>
                                <td>
                                    <a href="#" onclick="removeResource('{{ resource.id }}')">
                                        <i class="fa fa-times" aria-hidden="true"></i>
                                    </a>
                                    <a href="/projects/{{ projectId }}/{{ projectName | slugify }}/resource/{{ resource.id }}/edit">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                            <tr id="add-new-resource" style="display: none;">
                                <td colspan="4">
                                    <form action="#" method="POST" class="form" id="add-new-resource-form">
                                        <div class="grid-row">
                                            <section>
                                                <div class="form-group">
                                                    <label class="form-label-bold" for="name">Name</label>
                                                    <p class="form-hint">Name for the link to the resource</p>
                                                    <input type="text" class="form-control" id="name" name="name">
                                                </div>

                                                <div class="form-group">
                                                    <label class="form-label-bold" for="url">URL</label>
                                                    <p class="form-hint">Web address of the resource</p>
                                                    <input type="url" class="form-control" id="url" name="url">
                                                </div>
                                            </section>
                                        </div>

                                        <div class="form-group">
                                            <input type="submit" class="button" value="Submit">
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            <tr id="add-btn-row">
                                <td colspan="4"><a href="#" onclick="addResource()">
                                    <i class="fa fa-plus" aria-hidden="true"></i>
                                </a></td>
                            </tr>
                        </table>
                    </div>
                </section>

            </div>
        </section>
    </div>
</main>
{% endblock %}

{% block body_end %}
{{ super() }}
<script>
    $("#add-new-resource-form").submit(function(e) {
        e.preventDefault();

        var data = $('#add-new-resource-form').serializeObject();

        $.ajax({
            type: "POST",
            url: '/api/projects/{{ projectId }}/resource',
            contentType: "application/json",
            data: JSON.stringify(data)

        })
        .done(function(response) {
            alert(JSON.stringify(response.messages[0]));
            location.reload();
        })
        .fail(function(jqXHR) {
            alert('There was an error adding resource. ' + jqXHR.responseText);
        });
    });

    function addResource() {
        $('#add-new-resource').css('display', 'block');
        $('#add-btn-row').css('display', 'none');
    }

    function removeResource(resourceId) {
        $.ajax({
            type: "DELETE",
            url: '/api/projects/{{ projectId }}/resource/' + resourceId,
            contentType: "application/json"
        })
        .done(function(response) {
            alert(JSON.stringify(response.messages[0]));
            location.reload();
        })
        .fail(function(jqXHR) {
            alert('There was an error removing resource. ' + jqXHR.responseText);
        });
    }
</script>
{% endblock %}
