{% extends "layout.html" %} {% block content %}
<main id="content" role="main">
    <div class="grid-row">
        <section class="column-two-thirds" />
        <p>
            Our services, ordered by {{ view }}
            <!-- {% if view != 'agency' %}(<a href="/dashboard/sales/agency">order by agency</a>){% endif %} -->
            <!-- {% if view != 'theme' %}(<a href="/dashboard/sales/theme">order by theme</a>){% endif %} -->
            {% if view != 'location' %}(<a href="/dashboard/sales/location/">order by location</a>){% endif %}
            <!-- {% if view != 'priority' %}(<a href="/dashboard/sales/priority">order by priority</a>){% endif %} -->
            {% if view != 'health' %}(<a href="/dashboard/sales/health">order by health</a>){% endif %}
        </p>

        <label class="form-checkbox" for="checkbox-show-finished">
            <input id="checkbox-show-finished" name="contact-by-text-phone"
                type="checkbox" value="true"
                {{ "checked" if showFinished else "" }}>
                Show finished projects
        </label>
		 
		<form action="#" class="form" id="filter-form">
			<div class="form-group">
				<label class="form-label" for="tags">Search Tags</label>
				<input type="text" width class="form-control" id="search-tags" name="tags" value="{{ searchTags }}">
			</div>
			<div class="form-group">
				<input id="submit-btn" type="submit" class="button" value="Submit">
				<input id="clearfilter-btn" name="Clear Filter" type="submit" class="button" value="Clear Filter">
			</div>
		</form>

        </section>
    </div>
    <div class="grid-row">
        {% for phase in phase_order %}
        <a href="?phase={{ phase }}">
            <section class="column-fifth">
                <div class="tag {{ phase }}">{{ phase }}</div>
                <div class="big_number txt-{{ phase }}">
                    {{ counts[phase] }}
                </div>
            </section>
        </a>
        {% endfor %}
    </div>
    {% if phase and phase != "all" %}
    <p>Showing projects in {{ phase }} phase. <a href="?phase=all">Show all</a></p>
    {% endif %} {% for name in row_order %} {% set item = data[name] %}
    <h2 class="font-large service-area">{{ name | title }}</h2> {% if view == 'priority' %}
    <p>{{ priority_descriptions[name] }}</p>
    {% endif %}
    <div class="grid-row">
        {% for phase in phase_order %}
        <section class="column-fifth">
            {% if item[phase] %} {% for bit in item[phase]['user'] %}
            <ul class="link-list border-{{phase}}">
                <li><a href="/projects/{{ bit.id }}/{{ bit.name | slugify }}">{{ bit.customer }} - {{ bit.name }}</a></li>
            </ul>
            {% endfor %} {% for bit in item[phase]['internal'] %}
            <ul class="link-list border-internal">
                <li><a href="/projects/{{ bit.id }}/{{ bit.name | slugify }}">{{ bit.customer }} - {{ bit.name }}</a></li>
            </ul>
            {% endfor %} {% else %}&nbsp;{% endif %}
        </section>
        {% endfor %}
    </div>
    {% endfor %}
</main>
{% endblock %} {% block body_end %} {{ super() }}
<script>

	$('#search-tags').tagsInput();

   //$("#search-tags").change(function() {
   //    
	//	if (this.value != '') {
   //        Cookies.set("searchTags", this.value); // provided by cookie.js
   //    } else {
   //        Cookies.remove("searchTags");
   //    }
   //    location.reload();
   //});

    $("#checkbox-show-finished").change(function() {
        if(this.checked) {
            Cookies.set("showFinished", true); // provided by cookie.js
        } else {
            Cookies.remove("showFinished");
        }
        location.reload();
    }); 
	
	var buttonpressed; 
	$("#clearfilter-btn").click(function() { 
		buttonpressed = $(this).attr('value');
	});
	
	$("#filter-form").submit(function(e) {
		e.preventDefault();
		if (buttonpressed == "Clear Filter")
		{
			Cookies.remove("searchTags");
			$('#search-tags').importTags("Exemplar,CaseStudy,DeliveryPartner,MultiSupplier,Consultancy,Colocated,Migration,ManagedCloud,Enablement,UserResearch");
			
		} else {	
		
			Cookies.set("searchTags", $("#search-tags").val()); // provided by cookie.js
		}
		
		buttonpressed = '';
		location.reload();
	});
	
	$(document).ready(function() {
	
	$('#search-tags').value = "1,";
	
		if (Cookies.get("searchTags"))
		{
			$("#search-tags").value = Cookies.get("searchTags");
			//remove the cookie so it isn't persisted past the life of the session
			Cookies.remove("searchTags");
		} else {
			$('#search-tags').importTags("Exemplar,CaseStudy,DeliveryPartner,MultiSupplier,Consultancy,Colocated,Migration,ManagedCloud,Enablement,UserResearch");
			
		}
	});
	
</script>
{% endblock %}

